description "Spark Worker"

# automatically start
start on filesystem

# auto respawn service
respawn
#respawn limit 15 5

# start script
script
    export SPARK_MASTER_IP=$(curl -s http://169.254.169.254/latest/meta-data/public-hostname)
    export SPARK_WORKER_IP=$SPARK_MASTER_IP
    printf "SPARK_MASTER_IP=$SPARK_MASTER_IP"
    exec {{spark_home}}/sbin/start-master.sh
    exec {{spark_home}}/bin/spark-class org.apache.spark.deploy.worker.Worker --ip $SPARK_WORKER_IP $SPARK_MASTER_IP
end script